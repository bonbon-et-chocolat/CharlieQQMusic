<mvc:View
	controllerName="charlie.data.controller.Songlist"
	xmlns:m="sap.m"
	xmlns:f="sap.f"
	xmlns:card="sap.f.cards"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns="sap.uxap"
	xmlns:layout="sap.ui.layout">
	<ObjectPageLayout
		id="page"
		showFooter="true">
		<headerTitle>
			<ObjectPageDynamicHeaderTitle>
				<expandedHeading>
					<m:Title text="周深QQ音乐音源数据" wrapping="true"/>
				</expandedHeading>

				<expandedContent>
					<m:Text text="上次更新：{dataModel>/data/updatedAt}"/>
				</expandedContent>

				<snappedContent>
					<m:Text text="周深QQ音乐音源数据"/>
				</snappedContent>

				<snappedTitleOnMobile>
					<m:Title text="周深QQ音乐音源数据 {dataModel>/data/updatedAt}"/>
				</snappedTitleOnMobile>
				<actions>
					<m:Button icon="sap-icon://feedback" text="辣锅纯辣锅" type="Transparent" press=".openAd"/>
				</actions>
			</ObjectPageDynamicHeaderTitle>
		</headerTitle>
		<headerContent>
			<m:FlexBox wrap="Wrap">
				<m:Avatar class="sapUiSmallMarginEnd" src="./img/zhoushen.png"  displaySize="L" />
				<layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
					<m:Label text="QQ音乐粉丝总数： {dataModel>/data/fansCount}"/>
					<m:Label text="过去24小时收听总人数： {dataModel>/data/totalListenCount}万+"/>
					<m:Label text="数据非实时。每日上午11点更新。"/>
				</layout:VerticalLayout>
			</m:FlexBox>
		</headerContent>
		<sections>
			<ObjectPageSection titleUppercase="false" class="section" id="hotSection" title="巅峰指数" importance="High">
				<subSections>
					<ObjectPageSubSection id="hit-rank" title="巅峰指数" titleUppercase="false">
						<blocks>
							<m:Table
								id="hit-table"
								width="auto"
								class="sapUiResponsiveMargin"
								growing="true"
								items="{
										path: 'dataModel>/data/details',
										filters: [{path: 'score', operator: 'GT', value1: '0'}],
										sorter: {
											path: 'score',
											descending: true
										}
									}"
								busy="{viewModel>/songsLoading}"
								busyIndicatorDelay="0">
								<m:columns>
									<m:Column>
										<m:Text text="歌曲"/>
									</m:Column>
									<m:Column>
										<m:Text text="巅峰指数"/>
									</m:Column>
									<m:Column>
										<m:Text text="收听人数"/>
									</m:Column>
								</m:columns>
								<m:items>
									<m:ColumnListItem
										vAlign="Middle"
										press=".onPress">
										<m:cells>
											<m:ObjectIdentifier
												title="{dataModel>title}"/>
											<m:ObjectNumber
												textAlign="Right"
												number="{
													path: 'dataModel>score',
													formatter: '.formatter.formatNumberWithCommas'
												}"/>
											<m:ObjectNumber
												textAlign="Right"
												numberUnit="w+"
												number="{
													path: 'dataModel>hitListenCount',
													formatter: '.formatter.formatNumberWithCommas'
												}"/>
										</m:cells>
									</m:ColumnListItem>
								</m:items>
							</m:Table>
						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

			<ObjectPageSection titleUppercase="false" class="section" id="newSection" title="榜单成绩" importance="High">
				<subSections>
					<ObjectPageSubSection id="new-rank" title="排行榜（过去24小时）" titleUppercase="false">
						<blocks>
							<f:GridContainer
								id="ranking-grid"
								class="sapUiSmallMargin"
								busy="{viewModel>/songsLoading}"
								busyIndicatorDelay="0"
								items="{
									path: 'dataModel>/data/details',
									filters: [{path: 'score', operator: 'GT', value1: '0'}],
									sorter: {
										path: 'score',
										descending: true
									}
								}">
								<f:layout>
									<f:GridContainerSettings rowSize="84px" columnSize="84px" gap="8px" />
								</f:layout>
								<f:layoutXS>
									<f:GridContainerSettings rowSize="70px" columnSize="70px" gap="8px" />
								</f:layoutXS>
								<f:Card>
									<f:layoutData>
										<f:GridContainerItemLayoutData columns="4" />
									</f:layoutData>
									<f:header>
										<card:Header title="{dataModel>title}" subtitle="发行于：{dataModel>timePublic}" />
									</f:header>
									<f:content>
										<m:VBox class="sapUiSmallMargin" 
											items="{
												path: 'dataModel>record',
												factory: '.createRecordContent'
											}"></m:VBox>
									</f:content>
								</f:Card>
							</f:GridContainer>
						</blocks>
					</ObjectPageSubSection>
					<ObjectPageSubSection id="yobang" title="由你音乐榜 ({yobangModel>/updatedAt}）" titleUppercase="false">
						<blocks>
							<m:Table
								id="yobang-table"
								width="auto"
								class="sapUiResponsiveMargin"
								growing="true"
								items="{
										path: 'yobangModel>/data',
										sorter: {
											path: 'rank',
											descending: false
										}
									}"
								busy="{viewModel>/yobangLoading}"
								busyIndicatorDelay="0">

								<m:columns>
									<m:Column id="yo-title">
										<m:Text text="歌曲"/>
									</m:Column>
									<m:Column id="yo-rank">
										<m:Text text="排名"/>
									</m:Column>
									<m:Column id="yo-index">
										<m:Text text="指数"/>
									</m:Column>
								</m:columns>
								<m:items>
									<m:ColumnListItem
										vAlign="Middle"
										press=".onPress">
										<m:cells>
											<m:ObjectIdentifier
												title="{yobangModel>songName}"/>
											<m:ObjectNumber
												textAlign="Right"
												number="{
													path: 'yobangModel>rank'
												}"/>
											<m:Text
												text="{yobangModel>uniIndex}"/>
										</m:cells>
									</m:ColumnListItem>
								</m:items>
							</m:Table>
						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

			<ObjectPageSection titleUppercase="false" class="section" id="favSection" title="收藏榜" importance="High">
				<subSections>
					<ObjectPageSubSection id="favRank" title="收藏Top{dataModel>/result}" titleUppercase="false">
						<blocks>
							<m:Table
								id="fav-table"
								width="auto"
								class="sapUiResponsiveMargin"
								growing="true"
								items="{
										path: 'dataModel>/data/details',
										sorter: {
											path: 'favCount',
											descending: true
										}
									}"
								busy="{viewModel>/songsLoading}"
								busyIndicatorDelay="0">
								<m:headerToolbar>
									<m:Toolbar>
										<m:Label id="tableHeader" text=""/>
										<m:ToolbarSpacer />
										<m:SearchField id="searchField" width="auto" search=".onFilterSongs" />
									</m:Toolbar>
								</m:headerToolbar>
								<m:columns>
									<m:Column id="title">
										<m:Text text="歌曲"/>
									</m:Column>
									<m:Column id="fav">
										<m:Text text="收藏"/>
									</m:Column>
									<m:Column id="time">
										<m:Text text="发行时间"/>
									</m:Column>
								</m:columns>
								<m:items>
									<m:ColumnListItem
										vAlign="Middle"
										press=".onPress">
										<m:cells>
											<m:ObjectIdentifier
												title="{dataModel>title}"/>
											<m:ObjectNumber
												textAlign="Right"
												number="{
													path: 'dataModel>favCount',
													formatter: '.formatter.formatNumberWithCommas'
												}"/>
											<m:Text
												text="{dataModel>timePublic}"/>
										</m:cells>
									</m:ColumnListItem>
								</m:items>
							</m:Table>
						</blocks>
					</ObjectPageSubSection>
				</subSections>
			</ObjectPageSection>

		</sections>
		<footer>
			<m:OverflowToolbar>
				<m:Text text="辣锅纯辣锅出品"/>
				<m:ToolbarSpacer/>
				<m:Button icon="sap-icon://history" text="历史数据" press=".openHistory"/>
				<m:Button icon="sap-icon://business-objects-experience" text="总结图表" press=".openViz"/>
			</m:OverflowToolbar>
		</footer>
	</ObjectPageLayout>
</mvc:View>
